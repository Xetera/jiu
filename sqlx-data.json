{
  "db": "PostgreSQL",
  "02c2cc08aac3620a973bbf9c1bf479fda921d0027fefaeb2b19183520d1c8a8b": {
    "query": "INSERT INTO scrape_error (scrape_id, response_code, response_body)\n                            VALUES ($1, $2, $3) returning id",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        }
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Text",
          "Text"
        ]
      },
      "nullable": [
        false
      ]
    }
  },
  "299433bbcf3b5df1fdf1e96cc0bf6c0128ee763636444ada07875180c9533c8b": {
    "query": "SELECT sr.scrape_id, scrape_request_id, page_url, image_url\n        FROM media m\n        join scrape_request sr\n            on sr.id = m.scrape_request_id\n        join scrape s\n            on s.id = sr.scrape_id\n        where s.id = ANY($1)",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "scrape_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "scrape_request_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 2,
          "name": "page_url",
          "type_info": "Text"
        },
        {
          "ordinal": 3,
          "name": "image_url",
          "type_info": "Text"
        }
      ],
      "parameters": {
        "Left": [
          "Int4Array"
        ]
      },
      "nullable": [
        true,
        true,
        true,
        true
      ]
    }
  },
  "33bc71a5f13a714f89e58bc61a845ec4c0c5cc452b1ff65d8d1ac7bf52c3231a": {
    "query": "SELECT * FROM provider_resource pr\n        WHERE pr.enabled AND\n        (pr.last_queue IS NULL OR pr.last_queue + '1.5 hour' < NOW())\n        ORDER BY pr.last_scrape desc nulls first, created_at desc\n        LIMIT 5",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "destination",
          "type_info": "Text"
        },
        {
          "ordinal": 2,
          "name": "name",
          "type_info": "Text"
        },
        {
          "ordinal": 3,
          "name": "enabled",
          "type_info": "Bool"
        },
        {
          "ordinal": 4,
          "name": "url",
          "type_info": "Text"
        },
        {
          "ordinal": 5,
          "name": "priority",
          "type_info": "Int4"
        },
        {
          "ordinal": 6,
          "name": "last_scrape",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 7,
          "name": "last_queue",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 8,
          "name": "created_at",
          "type_info": "Timestamp"
        }
      ],
      "parameters": {
        "Left": []
      },
      "nullable": [
        false,
        false,
        false,
        true,
        false,
        false,
        true,
        true,
        true
      ]
    }
  },
  "5152711d2896afed80497c24bc489a442333b0cb6664243a85e05688253991af": {
    "query": "SELECT\n            pr.id,\n            pr.name,\n            pr.destination,\n            pr.priority as resource_priority,\n            s.scraped_at,\n            s.priority,\n            (SELECT COUNT(*)\n              FROM media m\n              INNER JOIN scrape_request sr\n                on sr.id = m.scrape_request_id\n              where sr.scrape_id = s.id\n            ) as discovery_count\n        FROM provider_resource pr\n        LEFT JOIN LATERAL (\n            SELECT *\n            FROM scrape s\n            WHERE s.provider_name = pr.name\n              AND s.provider_destination = pr.destination\n            ORDER BY last_scrape desc, id\n            LIMIT 10\n        ) s on True\n        WHERE pr.enabled AND pr.id = ANY($1)",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "name",
          "type_info": "Text"
        },
        {
          "ordinal": 2,
          "name": "destination",
          "type_info": "Text"
        },
        {
          "ordinal": 3,
          "name": "resource_priority",
          "type_info": "Int4"
        },
        {
          "ordinal": 4,
          "name": "scraped_at",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 5,
          "name": "priority",
          "type_info": "Int4"
        },
        {
          "ordinal": 6,
          "name": "discovery_count",
          "type_info": "Int8"
        }
      ],
      "parameters": {
        "Left": [
          "Int4Array"
        ]
      },
      "nullable": [
        false,
        false,
        false,
        false,
        true,
        true,
        null
      ]
    }
  },
  "65e8fb5adf1849d3e0ad897c225b6eb50cabb59246dfc6c34e124fc77553ae52": {
    "query": "INSERT INTO webhook_invocation (\n                    scrape_id,\n                    webhook_id,\n                    response_code,\n                    response_delay\n                ) VALUES ($1, $2, $3, $4) RETURNING *",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "scrape_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 2,
          "name": "webhook_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 3,
          "name": "response_code",
          "type_info": "Int4"
        },
        {
          "ordinal": 4,
          "name": "response_delay",
          "type_info": "Int4"
        },
        {
          "ordinal": 5,
          "name": "invoked_at",
          "type_info": "Timestamptz"
        }
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Int4",
          "Int4"
        ]
      },
      "nullable": [
        false,
        true,
        true,
        true,
        true,
        false
      ]
    }
  },
  "991d7485cf79e8d722409ae0e7ccb2d6c74ee4eb8df27dae784d611be88a4c0f": {
    "query": "UPDATE provider_resource SET priority = $1 where id = $2 returning id",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        }
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      },
      "nullable": [
        false
      ]
    }
  },
  "99e22495966aeaf571d1284b6d8bb43157648ce44bb1f0ae9ef14df967b39642": {
    "query": "UPDATE provider_resource SET last_queue = NOW() WHERE id = ANY($1)",
    "describe": {
      "columns": [],
      "parameters": {
        "Left": [
          "Int4Array"
        ]
      },
      "nullable": []
    }
  },
  "9edd53013cf08a340b0bc52fb02a894146bb8cca3a7d58281910f9779e67e9a6": {
    "query": "SELECT webhook.* FROM webhook\n        JOIN webhook_source on webhook_source.webhook_id = webhook.id\n        WHERE webhook_source.provider_destination = $1 AND webhook_source.provider_name = $2",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "destination",
          "type_info": "Text"
        },
        {
          "ordinal": 2,
          "name": "created_at",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 3,
          "name": "updated_at",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 4,
          "name": "metadata",
          "type_info": "Jsonb"
        }
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text"
        ]
      },
      "nullable": [
        false,
        false,
        false,
        false,
        true
      ]
    }
  },
  "ab5492641d9960173e369d2ee9d2644a0e6ebd17ba0fc0d8ed5d375b56419e52": {
    "query": "UPDATE provider_resource SET last_scrape = NOW() WHERE name = $1 AND destination = $2 RETURNING *",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "destination",
          "type_info": "Text"
        },
        {
          "ordinal": 2,
          "name": "name",
          "type_info": "Text"
        },
        {
          "ordinal": 3,
          "name": "enabled",
          "type_info": "Bool"
        },
        {
          "ordinal": 4,
          "name": "url",
          "type_info": "Text"
        },
        {
          "ordinal": 5,
          "name": "priority",
          "type_info": "Int4"
        },
        {
          "ordinal": 6,
          "name": "last_scrape",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 7,
          "name": "last_queue",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 8,
          "name": "created_at",
          "type_info": "Timestamp"
        }
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text"
        ]
      },
      "nullable": [
        false,
        false,
        false,
        true,
        false,
        false,
        true,
        true,
        true
      ]
    }
  },
  "bc01c48c8779e64839debbeb313a9fa62880dea90258c30bea3ec2130baf63bd": {
    "query": "INSERT INTO scrape_request (scrape_id, response_code, response_delay, scraped_at, page)\n                    VALUES ($1, $2, $3, $4, $5)\n                    RETURNING id",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        }
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Int4",
          "Timestamp",
          "Int4"
        ]
      },
      "nullable": [
        false
      ]
    }
  },
  "c0d3b2d9e68072277d753efaf3196b7e80ffc642d011a233a5000ce1c353347d": {
    "query": "select\n                sr.id as scrape_request_id,\n                s.id as scrape_id,\n                pr.name,\n                sr.response_delay,\n                sr.response_code,\n                sr.scraped_at,\n                pr.url\n            from scrape_request sr\n            join scrape s\n                on s.id = sr.scrape_id\n            join provider_resource pr\n                on pr.name = s.provider_name and pr.destination = s.provider_destination\n            ORDER BY sr.scraped_at desc\n            LIMIT 50",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "scrape_request_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "scrape_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 2,
          "name": "name",
          "type_info": "Text"
        },
        {
          "ordinal": 3,
          "name": "response_delay",
          "type_info": "Int4"
        },
        {
          "ordinal": 4,
          "name": "response_code",
          "type_info": "Int4"
        },
        {
          "ordinal": 5,
          "name": "scraped_at",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 6,
          "name": "url",
          "type_info": "Text"
        }
      ],
      "parameters": {
        "Left": []
      },
      "nullable": [
        false,
        false,
        false,
        true,
        true,
        false,
        false
      ]
    }
  },
  "c4f3edadfc3c1119fc2a8b561a512cae31cecee4336add5411a786586f3210a5": {
    "query": "SELECT unique_identifier FROM media\n        WHERE provider_name = $1 AND provider_destination = $2\n        order by id desc, discovered_at desc limit 100",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "unique_identifier",
          "type_info": "Text"
        }
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text"
        ]
      },
      "nullable": [
        false
      ]
    }
  },
  "cd8f4252ecc21f84c3d65093ec5c87580f7c5d9cdf5f767c79e39018eb87e4a6": {
    "query": "INSERT INTO scrape (provider_name, provider_destination, priority) VALUES ($1, $2, $3) returning id",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        }
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Int4"
        ]
      },
      "nullable": [
        false
      ]
    }
  },
  "d1d471d3f9095ebb9d2dc56aab261193cdbd35cb2b176abe518afff386974e02": {
    "query": "INSERT INTO scrape_error (scrape_id, response_code)\n                                VALUES ($1, $2)",
    "describe": {
      "columns": [],
      "parameters": {
        "Left": [
          "Int4",
          "Text"
        ]
      },
      "nullable": []
    }
  },
  "f1113a322ab52cfaa9bd33a5c29dcfc4fce2637dad650a25fb464266d0be97d6": {
    "query": "INSERT INTO media (\n                            provider_name,\n                            provider_destination,\n                            scrape_request_id,\n                            image_url,\n                            page_url,\n                            reference_url,\n                            unique_identifier,\n                            posted_at,\n                            discovered_at\n                        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\n                        ON CONFLICT (image_url) DO update set discovered_at = NOW() returning *",
    "describe": {
      "columns": [
        {
          "ordinal": 0,
          "name": "id",
          "type_info": "Int4"
        },
        {
          "ordinal": 1,
          "name": "provider_name",
          "type_info": "Text"
        },
        {
          "ordinal": 2,
          "name": "provider_destination",
          "type_info": "Text"
        },
        {
          "ordinal": 3,
          "name": "scrape_request_id",
          "type_info": "Int4"
        },
        {
          "ordinal": 4,
          "name": "image_url",
          "type_info": "Text"
        },
        {
          "ordinal": 5,
          "name": "page_url",
          "type_info": "Text"
        },
        {
          "ordinal": 6,
          "name": "reference_url",
          "type_info": "Text"
        },
        {
          "ordinal": 7,
          "name": "unique_identifier",
          "type_info": "Text"
        },
        {
          "ordinal": 8,
          "name": "posted_at",
          "type_info": "Timestamp"
        },
        {
          "ordinal": 9,
          "name": "discovered_at",
          "type_info": "Timestamp"
        }
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Int4",
          "Text",
          "Text",
          "Text",
          "Text",
          "Timestamp",
          "Timestamp"
        ]
      },
      "nullable": [
        false,
        true,
        true,
        true,
        false,
        true,
        true,
        false,
        true,
        false
      ]
    }
  }
}